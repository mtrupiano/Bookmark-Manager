
<nav>
    <div class="nav-wrapper valign-wrapper">
        
        <a href="/" class="brand-logo">webM8</a>

        <div id="user-display">

            <div class="row valign-wrapper" style="line-height: normal;">
                <div class="col" >
                    <span id="username-display" class="right">
                        Signed in as: {{username}}
                    </span>
                </div>
            </div>

            <div class="row">
                <div class="col right">
                    <button class="btn right" id="sign-out-btn">Sign out</button>
                </div>
            </div>

        </div>
    </div>
</nav>

<div class="container">
    <ul class="collapsible expandable"> 
        {{#each collections}}
            {{> collectionPartial}}
        {{/each}}

    </ul>
</div>

<script type="text/javascript" src="https://chir.ag/projects/ntc/ntc.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var elems = document.querySelectorAll('.collapsible');
        var instances = M.Collapsible.init(elems, {"accordion": false});
    });

    $(document).ready(() => {

        $('.sidenav').sidenav();
        $('.dropdown-trigger').dropdown();

        $('#sign-out-btn').click( (event) => {
            event.preventDefault();
            $.ajax({
                url: "/logout",
                type: "GET"
            }).then( () => {
                location.replace('/splash')
            }).fail( (err) => {
                console.log(err);
            });
        });

        $('.bookmark-li').click( (event) => {
            event.preventDefault();
            const target = $(event.target);
            let id;
            if (target.prop("tagName") === "I") {
                id = target.parent().attr("value");
            } else {
                id = target.attr("value");
            }
            console.log(id);
        });

        $('.color-dropdown-trigger').click( (event) => {
            event.stopPropagation();


            $('.collection-color-dropdown').css(`top`, event.pageY - event.offsetY + 28);
            $('.collection-color-dropdown').css(`left`, event.pageX - event.offsetX + 1);
            $('.collection-color-dropdown').css("visibility", "visible");
            $('.collection-color-dropdown').css("opacity", "1");
        });


        $('.collection-color-dropdown-select').click( (event) => {
            event.stopPropagation();
            $('.collection-color-dropdown').css("opacity", "0");
            $('.collection-color-dropdown').css("visibility", "hidden");


            const target = $(event.target);
            var newColor, targetEntityID, targetLink;
            const apiURL = "/api/collections/color";

            if (target.prop("tagName") === "A") {

                targetLink = target.parent().parent();
                targetEntityID = targetLink.attr("data-id");

                newColor = $(target.children()[0]).css("color");
                if (newColor === "rgb(56, 56, 56)") {
                    newColor = "rgb(255, 255, 255)";
                }

            } else if (target.prop("tagName") === "I") {

                targetLink = target.parent().parent().parent();
                targetEntityID = targetLink.attr("data-id");

                newColor = target.css("color");
                if (newColor === "rgb(56, 56, 56)") {
                    newColor = "rgb(255, 255, 255)";
                }
            }

            console.log(apiURL);

            $.ajax({
                url: apiURL,
                type: "PUT",
                data: {
                    "ids": [targetEntityID],
                    "newColor": newColor
                },
                processData: true
            }).then( () => {
                const targetEntity = 
                    $(`.color-dropdown-trigger[data-id=${targetEntityID}]`);

                if (newColor === "rgb(255, 255, 255)") {
                    $(targetEntity.children()[0]).text("panorama_fish_eye");
                    $(targetEntity.children()[0]).css("color", "rgb(56, 56, 56)");
                } else {
                    $(targetEntity.children()[0]).text("circle");
                    $(targetEntity.children()[0]).css("color", newColor);
                }
            }).fail( (err) => {
                alert(err.responseText)
            });
        });

        $('#new-collection').click( (event) => {
            console.log("Hello")
        });

        $('#new-bookmark').click( (event) => {
            console.log("Hello");
        });

    });

</script>
